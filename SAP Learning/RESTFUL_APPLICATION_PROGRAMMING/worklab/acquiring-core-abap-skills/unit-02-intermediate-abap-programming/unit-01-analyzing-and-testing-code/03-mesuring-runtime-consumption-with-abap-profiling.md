# üå∏ 3 [MEASURING RUNTIME CONSUMPTION WITH ABAP PROFILING](link)

> üå∫ Objectifs
>
> - [ ] Profilage d'un programme ABAP
>
> - [ ] D√©tecter les lectures s√©quentielles gr√¢ce au profilage ABAP

## üå∏ THE ABAP PROFILER TOOL

![](./assets/01-ABAP_Profiler_001.png)

Le profileur ABAP est un outil de tra√ßage ABAP int√©gr√© aux outils de d√©veloppement ABAP (ADT). Il est disponible pour tout code ABAP ex√©cutable, par exemple les classes globales ou les tests unitaires ABAP.

√Ä partir du tra√ßage ABAP (r√©sultats du profileur ABAP), vous pouvez¬†:

#### üíÆ **Analyze the Performance** :

- Identifier les instructions co√ªteuses en temps d'ex√©cution

- Identifier les points critiques de performance sur lesquels concentrer vos efforts de refactorisation

- Comparer les performances de diff√©rentes impl√©mentations pour choisir la conception la plus efficace

#### üíÆ **Analyze the Program Flow** :

- Analyser la hi√©rarchie des appels dans votre application

- Identifier l'utilisation excessive ou inutile des unit√©s de modularisation

#### üíÆ **Analyze the Database Access** :

- Identifier les op√©rations r√©p√©t√©es de la base de donn√©es, par exemple les instructions SELECT dans les boucles

- Identifier les objets de la base de donn√©es (tables et vues) auxquels votre application acc√®de

## üå∏ ABAP PROFILER EXECUTION

Vous pouvez d√©marrer le profileur ABAP pour un programme ABAP individuel directement depuis l'√©diteur de code source ABAP ou depuis l'explorateur de projets. Visionnez la d√©monstration ¬´¬†Comment profiler un programme ABAP et analyser le r√©sultat¬†¬ª plus loin dans cette le√ßon pour d√©couvrir comment proc√©der.

![](./assets/02-Starting_the_ABAP_Profiler_001.png)

### TRACE PARAMETERS

Les param√®tres de trace vous permettent d'influencer la taille et la granularit√© du r√©sultat de la trace. Comme illustr√© dans la figure, les param√®tres les plus importants sont¬†:

### AGGEGATION SETTINGS

Cette section vous permet de sp√©cifier la mani√®re dont le profileur g√®re les ex√©cutions r√©p√©t√©es, par exemple les appels r√©p√©t√©s d'une m√™me m√©thode. Plus le profileur agr√®ge, moins il n√©cessite d'espace de stockage pour le r√©sultat de la trace. Certains outils d'analyse ne sont pas disponibles pour les r√©sultats de trace agr√©g√©s.

Vous avez le choix entre trois options¬†:

- Aucune agr√©gation, taille de fichier maximale, tous les outils disponibles¬†;

- Agr√©gation partielle (par instruction d'appel), taille de fichier moyenne, s√©quence d'appels non disponible¬†;

- Agr√©gation compl√®te, taille de fichier minimale, arbre d'appels agr√©g√© non disponible¬†;

### STATEMENT GRANULARITY

Cette section vous permet de sp√©cifier la granularit√© de la mesure. Vous pouvez choisir parmi trois pr√©r√©glages courants ou, en choisissant ¬´¬†Instructions personnalis√©es¬†¬ª, saisir votre propre s√©lection sous ¬´¬†D√©tails¬†¬ª.

Votre choix influence la taille du fichier et la valeur informative du r√©sultat de la trace.

Les pr√©r√©glages suivants existent¬†:

- Unit√©s proc√©durales uniquement¬†: fichier de petite taille, le temps d'ex√©cution de toutes les instructions est attribu√© √† l'unit√© proc√©durale environnante (m√©thode).

- Unit√©s proc√©durales, SQL¬†: fichier de taille moyenne, le temps d'ex√©cution des acc√®s √† la base de donn√©es est trac√© s√©par√©ment et n'est pas attribu√© √† l'unit√© proc√©durale environnante.

- Unit√©s proc√©durales, SQL, tables internes¬†: fichier de grande taille, le temps d'ex√©cution des acc√®s √† la base de donn√©es et des op√©rations sur les tables internes est trac√© s√©par√©ment et n'est pas attribu√© √† l'unit√© proc√©durale environnante.

### START OPTION

Dans cette section, vous pouvez choisir le moment de d√©marrage du suivi. Vous disposez des options suivantes¬†:

- Imm√©diatement¬†: l'ex√©cution compl√®te du programme est suivie.

- Activation et d√©sactivation explicites¬†: l'ex√©cution du programme d√©marre avec le suivi d√©sactiv√©. Lorsque le programme atteint un point d'arr√™t, vous pouvez s√©lectionner ¬´¬†Activer/D√©sactiver le suivi ABAP¬†¬ª dans le menu contextuel du point d'arr√™t.

## üå∏ THE ABAP PROFILING PERSPECTIVE

Le profilage d'un programme ABAP s'effectue id√©alement dans la perspective du profilage ABAP. Visionnez la d√©monstration ¬´¬†Comment profiler un programme ABAP et analyser le r√©sultat¬†¬ª plus loin dans cette le√ßon pour d√©couvrir comment proc√©der.

![](./assets/03-ABAP_Profiling_Perspective_001.png)

Dans sa configuration standard, la perspective Profilage se compose de trois parties¬†:

#### üíÆ **Editor Area** :

La zone d'√©dition est identique √† celle des perspectives ABAP et D√©bogueur. Lorsque vous ouvrez un r√©sultat de trace, il s'affiche dans cette zone, dans un nouvel onglet.

#### üíÆ **Trace Area** :

Par d√©faut, cette zone comprend les vues suivantes¬†:

La vue Traces ABAP affiche les r√©sultats de la trace, organis√©s par projet et filtr√©s par utilisateur.

La vue Requ√™tes de trace ABAP vous permet de g√©rer vos requ√™tes et d'en cr√©er de nouvelles.

#### üíÆ **Details Area** :

Par d√©faut, cette zone contient la vue Propri√©t√©s. Si, dans la zone √âditeur, le focus est plac√© sur un objet du r√©f√©rentiel, la vue Propri√©t√©s affiche ses m√©tadonn√©es.

Lors de l'analyse d'un r√©sultat de trace, la vue Propri√©t√©s permet d'afficher les propri√©t√©s d'une mesure d'ex√©cution.

### THE TRACE OVERVIEW

Lorsque vous double-cliquez sur une entr√©e dans la vue Traces ABAP, le r√©sultat de la trace ABAP s'ouvre dans un nouvel onglet dans la zone de l'√©diteur.

![](./assets/03-ABAP_Profiling_Perspective_002.png)

Par d√©faut, l'onglet Aper√ßu est s√©lectionn√©. Il constitue le point de d√©part d'une analyse plus approfondie. L'aper√ßu des traces comprend les √©l√©ments suivants¬†:

#### üíÆ **General Information** :

Dans la section Informations g√©n√©rales, vous trouverez des informations administratives sur ce r√©sultat de trace¬†:

Quand la trace a-t-elle √©t√© cr√©√©e¬†? Qui l'a cr√©√©e¬†? Avec quels param√®tres d'agr√©gation¬†? Et ainsi de suite.

#### üíÆ **Runtime Distribution** :

La distribution du temps d'ex√©cution vous fournit des informations sur la r√©partition du temps d'ex√©cution trac√© entre les composants ABAP suivants¬†:

- ABAP¬†: temps d'ex√©cution consacr√© au traitement du code ABAP, hors programmes syst√®me ABAP.

- Dababase¬†: temps d'ex√©cution pass√© dans la base de donn√©es, √† effectuer des op√©rations.

- Syst√®me¬†: temps d'ex√©cution consacr√© au traitement du code ABAP dans les programmes syst√®me.

#### üíÆ **Analysis Tools** :

Cette section d√©crit bri√®vement les outils d'analyse int√©gr√©s √† l'affichage des r√©sultats de trace. Choisissez l'un des liens pour acc√©der √† l'outil correspondant. Vous pouvez √©galement naviguer via les onglets situ√©s sous l'affichage **Overview**.

## üå∏ ABAP TRACE ANALYSIS TOOLS

### THE CONDENSED HIT LIST

La **Condensed Hit List** vous permet de trouver les unit√©s proc√©durales les plus co√ªteuses, par exemple les m√©thodes.

Cette liste affiche les mesures d'ex√©cution des √©v√©nements de trace. Elle est dite condens√©e car elle se limite aux unit√©s proc√©durales. Les acc√®s √† la base de donn√©es et autres √©v√©nements de trace ne sont pas r√©pertori√©s ici.

> #### üçß Hint
>
> Si vous souhaitez consulter tous les √©v√©nements de trace, consultez plut√¥t la liste des r√©sultats.

![](./assets/04-ABAP_Trace_Analysis_Tools_001.png)

La liste affiche les donn√©es sous forme agr√©g√©e. Chaque unit√© proc√©durale n'appara√Æt qu'une seule fois, quels que soient son nombre d'appels et le nombre d'emplacements diff√©rents. Les colonnes **Executions** et **Callers** affichent le nombre total d'ex√©cutions et le nombre d'appels directs distincts pour cette unit√©.

La colonne **Total Time** affiche le temps d'ex√©cution en microsecondes entre le d√©but et la fin de l'appel. Si l'unit√© a √©t√© appel√©e plusieurs fois, la colonne affiche la somme des appels individuels. **Total Time** vous permet de visualiser la contribution totale des appels de proc√©dure. Dans l'exemple, le programme a pass√© un total de `15¬†485¬†¬µs` √† ex√©cuter la m√©thode `MAIN()` et un total de `3¬†451¬†¬µs` √† ex√©cuter la m√©thode `GET_FLIGHTS()`.

La colonne **Own Time** (instructions ABAP sp√©cifi√©es et non sp√©cifi√©es) affiche le temps d'ex√©cution en microsecondes, sans compter le temps d'attente des autres unit√©s proc√©durales. Examinons de plus pr√®s la m√©thode `MAIN( )`. Bien que la dur√©e totale soit de `15¬†485 ¬µs`, la valeur de cette colonne n'est que de `18 ¬µs`. Cela signifie que la m√©thode n'a pratiquement pas effectu√© de traitement, mais a pass√© la majeure partie de son temps √† attendre les m√©thodes qu'elle a appel√©es.

La colonne **Own Time** (instructions ABAP sp√©cifi√©es et non sp√©cifi√©es) affiche le temps d'ex√©cution en microsecondes, sans compter le temps d'attente, non seulement pour les unit√©s proc√©durales appel√©es, mais aussi pour les instructions ABAP sp√©cifi√©es dans les param√®tres de trace. Dans l'exemple, la m√©thode `GT_FLIGHTS( )` n'appelle aucune autre m√©thode. Par cons√©quent, la valeur de **Own Time** (instructions ABAP sp√©cifi√©es et non sp√©cifi√©es) est identique √† la dur√©e totale. Cependant, la valeur de **Own Time** (instructions ABAP sp√©cifi√©es et non sp√©cifi√©es) n'est que de `4 ¬µs`, car la m√©thode a pass√© la quasi-totalit√© de son temps √† attendre un acc√®s √† la base de donn√©es.

### THE AGGREGATED CALL TREE

L'arbre d'appels agr√©g√© vous permet d'analyser la s√©quence d'appel des unit√©s proc√©durales.

Si l'appel d'une proc√©dure est r√©p√©t√© (par exemple, dans une boucle), il n'appara√Æt qu'une seule fois dans l'arbre d'appels agr√©g√©. Le nombre dans la colonne Ex√©cutions indique le nombre de r√©p√©titions.

> #### üçß Hint
>
> Si vous souhaitez un affichage non agr√©g√©, reportez-vous plut√¥t √† la section S√©quence d'appels.

![](./assets/04-ABAP_Trace_Analysis_Tools_002.png)

Dans l'exemple, la m√©thode `GET_FLIGHTS( )` a √©t√© appel√©e par la m√©thode `MAIN( )`, mais n'a appel√© aucune autre unit√© proc√©durale. La m√©thode `WRITE( )` a √©galement √©t√© appel√©e par la m√©thode `MAIN( )`, et a appel√© la m√©thode `EXEC_WRITE( )`, qui a √† son tour appel√© la m√©thode `GET_NAME( )`, et ainsi de suite.

## üå∏ HOW TO PROFILE AN ABAP PROGRAM AND ANALYZE THE RESULT

[R√©f√©rence - Link Vid√©o](https://learning.sap.com/learning-journeys/acquire-core-abap-skills/measuring-runtime-consumption-with-abap-profiling_fc6058d7-e6bd-49b2-9c85-89f714176758)

## üå∏ TIMELINE TOOLS

### THE AGGREGATED TIMELINE

La chronologie des appels vous permet de visualiser la s√©quence d'appel et le temps consomm√© sous forme de diagramme.

![](./assets/05-Timeline_Tools_001.png)

Le diagramme se compose de deux parties¬†: un aper√ßu de la trace compl√®te en bas et un d√©tail agrandi en haut. Une barre d'outils √† gauche permet de zoomer et de d√©placer le curseur.

La r√®gle au-dessus du diagramme des d√©tails indique le temps de gauche √† droite. Chaque barre illustre un √©v√©nement de trace avec son heure de d√©but et de fin. Plus une barre est large, plus le temps consacr√© √† cet √©v√©nement est important.

Cliquez sur une barre pour afficher ses d√©tails dans la section D√©tails de la perspective Profilage. Vous pouvez ainsi identifier l'√©v√©nement de trace repr√©sent√© par une barre.

Le diagramme utilise des couleurs pour distinguer les diff√©rents types d'√©v√©nements de trace¬†: gris (diff√©rentes nuances) pour les programmes syst√®me, vert (diff√©rentes nuances) pour les unit√©s proc√©durales, orange pour l'acc√®s √† la base de donn√©es, etc.

> #### üçß Hint
>
> Ouvrez le menu contextuel n'importe o√π sur le diagramme pour afficher ou masquer la l√©gende des couleurs. Dans notre exemple, nous avons masqu√© la l√©gende pour simplifier le graphique.

Prenons un exemple¬†:

#### üíÆ **First row** :

La longue barre grise tout en haut repr√©sente l'analyse d'ex√©cution.

#### üíÆ **Second Row** :

Sur la deuxi√®me ligne, nous voyons que l'analyse d'ex√©cution effectue deux acc√®s pr√©paratoires √† la base de donn√©es avant d'appeler la m√©thode `MAIN( )` de l'application.

#### üíÆ **Third Row** :

Sur la troisi√®me ligne, nous voyons que la m√©thode `MAIN( )` appelle deux m√©thodes¬†: `GET_FLIGHTS( )` et `WRITE( )`.

#### üíÆ **Fourth Row** :

La quatri√®me ligne r√©v√®le la structure des m√©thodes `GET_FLIGHTS( )` et `WRITE( )`. Nous pouvons voir que `GET_FLIGHTS( )` n'appelle aucune unit√© proc√©durale (pas de vert sous la barre repr√©sentant cette m√©thode), mais effectue un seul acc√®s √† la base de donn√©es (une barre orange). La m√©thode `WRITE()`, quant √† elle, n'a d'autre fonction que d'appeler une autre m√©thode. Cette m√©thode est repr√©sent√©e par la barre verte situ√©e sous celle de la m√©thode `WRITE`.

### REPEATED DATABASE ACCESSES IN THE CALL TIMELINE

L'affichage graphique dans la chronologie des appels est un tr√®s bon moyen d'identifier les acc√®s r√©p√©t√©s √† la base de donn√©es.

![](./assets/05-Timeline_Tools_002.png)

Prenons un exemple¬†: le motif r√©gulier en peigne des quatri√®me et cinqui√®me lignes sugg√®re une it√©ration. La couleur orange indique clairement qu'il ne s'agit pas uniquement de codage ABAP, mais d'un acc√®s r√©p√©t√© √† la base de donn√©es.

### DATABASE ACCESSES

L'outil Acc√®s √† la base de donn√©es vous permet de trouver les objets consult√©s et d'identifier les principaux utilisateurs parmi les acc√®s. Il permet √©galement d'identifier les s√©lections r√©p√©t√©es dans la m√™me table.

L'outil Acc√®s √† la base de donn√©es affiche uniquement les √©v√©nements de trace li√©s √† la base de donn√©es. Pour les acc√®s r√©p√©t√©s, le temps d'ex√©cution est agr√©g√©. Le nombre d'ex√©cutions est indiqu√© dans la colonne ¬´¬†Ex√©cutions¬†¬ª.

![](./assets/05-Timeline_Tools_003.png)

Dans l'exemple, deux tables ont √©t√© acc√©d√©es¬†: `/DMO/AIRPORT` et `/DMO/CONNECTION`. L'instruction `SELECT` lisant les donn√©es de `/DMO/CONNECTION` a pris `16¬†525¬†¬µs`, soit 5¬†% du temps d'ex√©cution total, et les 40¬†ex√©cutions d'une instruction `SELECT SINGLE` lisant les donn√©es de `/DMO/AIRPORT` ont consomm√© `59¬†894¬†¬µs`, soit 18¬†% du temps d'ex√©cution total.

## üå∏ HOW TO DETEXT SEQUENTIAL SELECTS USING ABAP PROFILING

[R√©f√©rence - Link Vid√©o](https://learning.sap.com/learning-journeys/acquire-core-abap-skills/measuring-runtime-consumption-with-abap-profiling_fc6058d7-e6bd-49b2-9c85-89f714176758)
