# üå∏ 1 [DEFINING RELATIONSHIPS BETWEEN DATABASE TABLES](https://learning.sap.com/learning-journeys/acquire-core-abap-skills/defining-relationships-between-database-tables_e55dbd61-6083-4747-bb5d-905ba29ab662)

> üå∫ Objectifs
>
> - [ ] Comprendre les relations dans les mod√®les de donn√©es
>
> - [ ] D√©finir les d√©pendances de cl√©s √©trang√®res dans les tables de dictionnaire

## üå∏ RELATIONSHIPS IN DATA MODELS

![](./assets/01RelationsInDataMode.png)

G√©n√©ralement, les entit√©s d'un mod√®le de donn√©es sont li√©es entre elles. La d√©finition d'un mod√®le de donn√©es inclut la d√©finition de ces relations.

Examinons le mod√®le de donn√©es d'une entreprise, qui comprend les entit√©s ¬´¬†Employ√©¬†¬ª et ¬´¬†Service¬†¬ª. Ces deux entit√©s sont li√©es car les employ√©s sont affect√©s √† des services.

Mais elles peuvent √©galement partager d'autres relations. Par exemple, chaque service est dirig√© par un employ√©.

![](./assets/01Rela.png)

Les cardinalit√©s ou multiplicit√©s sont des caract√©ristiques importantes d'une relation. Elles indiquent combien d'instances d'une entit√© appartiennent √† une instance de l'autre entit√©.

Il existe diff√©rents syst√®mes de notation pour les cardinalit√©s. Le langage de mod√©lisation unifi√© (UML), par exemple, utilise une valeur maximale et minimale, avec \* pour un maximum illimit√©.

Examinons nos exemples¬†:

Chaque employ√© doit √™tre affect√© √† un seul service. La cardinalit√© dans ce sens est donc de 1..1. Dans l'autre sens, un service peut avoir n'importe quel nombre d'employ√©s affect√©s, m√™me z√©ro est autoris√©. La cardinalit√© est donc de 0..\*.

Pour l'autre relation, consid√©rons que chaque service est dirig√© par un seul employ√©, ni plus ni moins. Cela signifie que nous ignorons les cas particuliers tels que les postes de direction vacants (z√©ro est une valeur autoris√©e) ou les doubles ou multiples dirigeants (les valeurs sup√©rieures √† 1 sont autoris√©es). Dans l'autre sens, nous pouvons facilement dire que tous les employ√©s ne sont pas des dirigeants, ce qui signifie que le minimum est de z√©ro. Nous avons d√©cid√© de fixer la valeur maximale √† 1, ce qui signifie qu'un employ√© ne peut pas diriger deux services simultan√©ment.

> #### üçß Note
>
> Dans le dictionnaire ABAP et ABAP CDS, cardinalit√© et multiplicit√© sont synonymes. Au sens strict, une cardinalit√© correspond au nombre r√©el d'instances, tandis que la multiplicit√© sp√©cifie la plage de valeurs autoris√©es.

![](./assets/01Rela2.png)

ABAP CDS et le dictionnaire ABAP utilisent des concepts diff√©rents pour exprimer les relations¬†:

#### üíÆ **Associations** :

ABAP CDS utilise des associations pour d√©finir les relations entre les entit√©s de vue CDS. G√©n√©ralement, une relation est refl√©t√©e par deux associations, pointant dans des directions oppos√©es.

#### üíÆ **Foreign Keys** :

ABAP Dictionary d√©finit une d√©pendance pour les champs de table afin d'√©tablir une relation avec une autre table de base de donn√©es. Une telle d√©pendance de cl√© √©trang√®re correspond √† une relation.

Explorons les possibilit√©s de d√©finition des relations en examinant de plus pr√®s les d√©pendances de cl√©s √©trang√®res dans le dictionnaire ABAP.

## üå∏ FOREIGN KEY DEFINITIONS IN DICTIONARY TABLES

![](./assets/02Fore.png)

Dans le dictionnaire ABAP, vous pouvez utiliser des d√©pendances de cl√©s √©trang√®res pour d√©finir les relations entre les tables.

En programmation ABAP moderne, ces d√©pendances de cl√©s √©trang√®res servent principalement √† la documentation. En d√©veloppement ABAP classique, en revanche, elles avaient une influence directe sur l'interface utilisateur. Elles donnaient lieu √† des v√©rifications implicites des entr√©es et √† des aides √† la saisie de valeurs.

> #### üçß Note
>
> Dans le d√©veloppement ABAP moderne, les associations entre entit√©s de vue CDS ont partiellement pris en charge cette t√¢che. Consultez la le√ßon suivante pour plus de d√©tails.

Il est important de noter que les d√©finitions de cl√©s √©trang√®res du dictionnaire ABAP restent sur la couche ABAP. Elles ne sont pas transmises √† la base de donn√©es. Par cons√©quent, elles n'entra√Ænent pas de v√©rifications implicites de coh√©rence dans la base de donn√©es.

![](./assets/02Fore2.png)

Une d√©pendance de cl√© √©trang√®re d√©finit une relation entre deux tables de base de donn√©es de dictionnaire¬†: la table de cl√©s √©trang√®res et la table de v√©rification.

Une d√©pendance de cl√© √©trang√®re compl√®te relie chaque champ de cl√© primaire de la table de v√©rification √† un champ correspondant de la table de cl√©s √©trang√®res. Dans l'exemple, la cl√© primaire de la table de v√©rification est compos√©e de trois champs¬†: C1, C2 et C3. La relation de cl√© √©trang√®re les relie aux champs F1, F2 et F6 de la table de cl√©s √©trang√®res. Ensemble, ces champs forment la cl√© √©trang√®re.

> #### üçß Note
>
> Une cl√© √©trang√®re peut comprendre n'importe quelle combinaison de champs¬†: des champs cl√©s et des champs non cl√©s. Les champs associ√©s de la table de v√©rification sont toujours des champs cl√©s.

La d√©pendance de cl√© √©trang√®re restreint les valeurs des champs de cl√© √©trang√®re¬†: seules les combinaisons pr√©sentes dans la table de v√©rification sont autoris√©es. Cette restriction est particuli√®rement importante pour le dernier champ de cl√© √©trang√®re, c'est-√†-dire celui li√© au dernier champ de cl√© primaire de la table de v√©rification. Ce champ est appel√© champ de v√©rification. Dans notre exemple, le champ de contr√¥le est le champ F6.

### EXAMPLE: FOREIGN KEY RELATIONSHIP

[R√©f√©rence - Link Vid√©o](https://learning.sap.com/learning-journeys/acquire-core-abap-skills/defining-relationships-between-database-tables_e55dbd61-6083-4747-bb5d-905ba29ab662)

## üå∏ SEMANTIC ATTRIBUTES OF FORIEGN KEYS

![](./assets/03Sema.png)

Lorsque vous d√©finissez une relation de cl√© √©trang√®re, vous pouvez ajouter des informations s√©mantiques pour la d√©crire plus en d√©tail et influencer son utilisation par le framework.

La majorit√© des informations s√©mantiques sont sp√©cifi√©es √† l'aide d'annotations de cl√© √©trang√®re. Seule la cardinalit√© est sp√©cifi√©e directement dans l'instruction DEFINE TABLE.

![](./assets/03Sema2.png)

Si un champ poss√®de une relation de cl√© √©trang√®re, vous pouvez ajouter les annotations de cl√© √©trang√®re suivantes¬†:

#### üíÆ **Short Description** :

Ce texte court sert d'explication pour une relation de cl√© √©trang√®re.

#### üíÆ **Foreign Key Field Type** :

L'annotation @AbapCatalog.foreignKey.keyType d√©crit la signification des champs de cl√© √©trang√®re dans la table de cl√©s √©trang√®res. Choisissez la valeur #KEY si tous les champs de cl√© √©trang√®re sont des champs cl√©s de la table de cl√©s √©trang√®res. Choisissez #NON_KEY si au moins un champ de cl√© √©trang√®re n'est pas un champ cl√© de la table de cl√©s √©trang√®res. Dans l'exemple, #NON_KEY est correct, car le champ DEPARTMENT_ID n'est pas un champ cl√© de la table EMPLOYEE. La troisi√®me valeur, #TEXT_KEY, est pertinente si la table de cl√©s √©trang√®res est une table texte, c'est-√†-dire qu'elle contient du texte traduisible pour la table de v√©rification.

#### üíÆ **Value Check for Classical UI** :

L'annotation @ABAPCatalog.foreignKey.screenCheck contr√¥le si les bo√Ætes de dialogue utilisateur classiques effectuent des v√©rifications de valeur en fonction de cette relation de cl√© √©trang√®re. Si cette option est d√©finie sur ¬´¬†true¬†¬ª, d'autres annotations sont disponibles pour sp√©cifier un message d'erreur d√©di√©. Sinon, un message d'erreur g√©n√©rique s'affiche.

> #### üçß Note
>
> Les annotations d'√©cran et de message ne sont pas pertinentes dans les dialogues utilisateur modernes. Sauf si vous envisagez de d√©velopper des interfaces utilisateur classiques, d√©finissez la valeur de @ABAPCatalog.foreignKey.screenCheck sur false.

![](./assets/03Sema3.png)

La cardinalit√© d√©crit une relation de cl√© √©trang√®re en fonction du nombre d'enregistrements d√©pendants (enregistrements de la table de cl√©s √©trang√®res) ou r√©f√©renc√©s (enregistrements de la table de v√©rification) possibles.

Dans le dictionnaire ABAP, la cardinalit√© est sp√©cifi√©e par [ n , m ] imm√©diatement apr√®s le mot-cl√© KEY.

- Le c√¥t√© gauche (n) sp√©cifie le nombre d'enregistrements de la table de cl√©s √©trang√®res par enregistrement de la table de v√©rification et peut prendre les valeurs 1, 0..1, 1.._ et 0.._.

- Le c√¥t√© droit (m) sp√©cifie le nombre d'enregistrements de la table de v√©rification par enregistrement de la table de cl√©s √©trang√®res et peut prendre les valeurs 1 ou 0..1.

![](./assets/03Sema4.png)

Pour choisir la cardinalit√© correcte, commencez par le c√¥t√© droit.

Choisissez m = 1 si le champ de v√©rification est obligatoire. Dans ce cas, chaque enregistrement de la table de cl√© √©trang√®re requiert une valeur dans le champ de v√©rification et un enregistrement correspondant dans la table de v√©rification.

Choisissez m = 0..1 si le champ de v√©rification est facultatif. Ainsi, les enregistrements sans valeur dans le champ de v√©rification ne n√©cessitent pas d'enregistrement correspondant dans la table de v√©rification.

Reprenons notre exemple avec les employ√©s et les services¬†:

S'il est obligatoire qu'un employ√© soit affect√© √† un service, la cardinalit√© de la cl√© √©trang√®re doit √™tre m = 1. S'il est √©galement possible qu'un employ√© ne soit pas affect√© √† un service, la cardinalit√© doit √™tre m = 0..1.

![](./assets/03Sema5.png)

Examinons maintenant le c√¥t√© gauche de la cardinalit√©. La signification des diff√©rentes valeurs est la suivante¬†:

#### üíÆ **n = 1** :

Il existe exactement un enregistrement d√©pendant (enregistrement de la table de cl√© √©trang√®re) pour chaque enregistrement de la table de v√©rification.

#### üíÆ **n = 0..1** :

Il existe au plus un enregistrement d√©pendant pour chaque enregistrement de la table de v√©rification. Cependant, certains enregistrements de la table de v√©rification ne poss√®dent aucun enregistrement d√©pendant dans la table de cl√© √©trang√®re.

#### üíÆ **n = 1..\*** :

Il existe au moins un enregistrement d√©pendant pour chaque enregistrement de la table de v√©rification.

#### üíÆ **n = 0..\*** :

Il peut y avoir n'importe quel nombre d'enregistrements d√©pendants pour chaque enregistrement de la table de v√©rification¬†: aucun, un ou plusieurs.

Dans notre exemple, posez-vous la question¬†: combien d'employ√©s peuvent √™tre affect√©s au m√™me service¬†? Exactement un¬†? Un seul au plus¬†? Au moins un¬†? N'importe quel nombre¬†? Qu'en pensez-vous¬†?

## üå∏ HOW TO DEFINE A FOREIGN KEY RELATIONSHIP

[R√©f√©rence - Link Vid√©o](https://learning.sap.com/learning-journeys/acquire-core-abap-skills/defining-relationships-between-database-tables_e55dbd61-6083-4747-bb5d-905ba29ab662)
